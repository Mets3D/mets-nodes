These nodes were designed to allow the creation of a workflow where you want to:
- Chain multiple checkpoints together, eg. render an anime image with txt2img, and then upscale and refine it with a realistic model, or even have a stylized step inbetween.
- Randomize your prompt in a highly controlled way by defining "tags", which you can reference in your prompt to replace a keyword with all the prompt words that describe it. For example, once you define a prompt which describes a character, you can always bring that character into your prompt with a single keyword, eg. `<miku>`. You can also define random variations within these tags, such as different outfits, hairstyles, etc, with the usual `{option a|option b}` syntax.
- Share your model dependencies with other users; You can store the CivitAI model IDs in nodes, so if another computer doesn't have them, they will be automatically downloaded.

![](docs/screenshot.png)

You can drag [this](docs/example.png) image into ComfyUI for an example workflow showing off most of the features.

### Primary Nodes
- Render Pass: This node includes a sampler, and is designed to be chainable, to allow conveniently building a workflow which chains multiple checkpoints together. For example, your first Render Pass could take an Empty Image as an input, and fully replace it with noise (txt2img), and then a 2nd render pass can take the result, upscale by 50%, and add 50% noise (img2img).
- Face Render Pass: Same as Render Pass but uses the FaceDetailer implementation from Impact Pack/Subpack. You need both of those installed.
- Prepare Render Pass: This node combines all the data from the previous nodes, and lets you provide a CivitAI API key (which you can get for free with an account) which will allow the system to automatically download missing LoRAs if they are still online. This does not work with Checkpoints due to frontent limitations. It also provides two seed values; One for the noise, and one for the prompt randomization. All of this combined can provide the Render Pass node with everything it needs, to make your prompting and workflow sharing more convenient.
- Tag Stacker: Make a single "tag" available in your prompt. For example, lets you define a tag called "random clothes" with the contents "{jacket|shirt|tanktop|bikini}". Later, if you type `<random clothes>` in the prompt for the RenderPass node, it will replace that tag with the provided contents. This node can be chained together to build up a database of tags. NOTE: Tags can also include tags, and they will all be un-rolled at the same time, so you can create a circular hierarchy of tags, which will result in an (un-guarded) infinite loop, so don't do that.
- TagTweaker: This node is simply a search & replace operation in your tag contents. Useful if you find yourself typing out combinations of prompt elements often, but don't want to define a tag for them, because you don't want to use them in your final prompt.
- Prepare Checkpoint: Can be chained together like the tag stacker to define a database of checkpoints; Their CivitAI model ID, the version name if you'd like to specify one, the filename if you'd like to override the default, and your settings for this model; Base prompts, cfg, steps, etc. These values will be used by the RenderPass node when the corresponding checkpoint is selected.
- Prepare LoRA: Same as Prepare Checkpoint, but for LoRAs. You can activate LoRAs by adding them to your prompt with this syntax: `<lora:MyLora:1.0>`. You do not need the full filepath, as long as the file exists somewhere in your `ComfyUI/models/loras/` directory. You also do not need the file extension, as `.safetensors` is hard-coded. If a LoRA is not present but its model ID is provided through this node (and an API key is provided), it will be automatically downloaded.
- Adjust Image: Brightness/Contrast/Saturation adjuster. I like putting this inbetween two render passes, for example to darken the result of the first pass, to help the 2nd pass create a night-time scene, or to de-saturate the first render pass made with a stylized checkpoint, to help the 2nd render pass look more realistic, with a realistic checkpoint.

### Misc Nodes
The functionality of these nodes is built into the RenderPass node, but you can also use them outside of that framework, if you so wish.
- CivitAI Model Downloader: I wasn't happy with the one that's online so I made my own. You can enter a model ID, your API key, a desired folder path, file name, and even model version name, and it will download it.
- StableRandomChoice: I wasn't happy with how ComfyUI or WildCardProcessor handles randomized elements of a prompt, such as {red|green|blue}, particularly when a lot of such randomized elements were in a prompt. When you modify the prompt without adding or removing any randomized elements, you might get a totally different result. Not with this node. Only if you add or remove random elements.
- Tidy Prompt: Adds commas at end of lines, removes lines starting with `#`, remove excess commas.
- Extract Tag From String: Kinda like an HTML tag, eg. if the input string is `a girl with <eye>blue eyes</eye>`, this node will extract the `blue eyes` part if you ask it to extract the `eye` tag. Useful for not having to jump between so many different input boxes for prompts, since you can eg. use <neg>to send stuff to your negative prompt</neg> or <face>to send stuff to your FaceDetailer prompt</face>.
- Auto Extract Tags From String: Good to run at the end of your other tag processing nodes, to remove any leftovers. Additionally, if the input contains a tag with an ! like `<!eye>` then the contents of any <eye> tags will be removed. You could use this to replace `blink` in your prompt with `blink <!eye>`, so when you want to quickly make your character blink, you can just add "blink" to your prompt and it will automatically remove any descriptions of eyes. (As long as your eyes are tagged properly)
- Regex Operations: Exactly that.
